{% extends 'basic.html' %}
{% block extra %}
{% load experience_filter %}

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>

  $(document).ready(function () {
    $('#example').DataTable({
      dom: 'Bfrtip',
      buttons: [
        'copyHtml5',
        'excelHtml5',
        'csvHtml5',
        'pdfHtml5'
      ]
    });
  });
</script>
{% endblock %}
{% block body %}
<center>
  <div>
    <h2 class="bg-info text-white">List of Employees</h2>
  </div>
</center>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
<div class="form-inline">
  <div class="d-inline-block">

    <span class="btn">
      DEPT
      <select class="btn" name="deptList" id="Bu" style="border-radius: 30px;">
        <!-- <option value="{{bu_select}}" selected hidden disabled>{{bu_select}}</option> -->
        {% for val in departments %}
        <option value="{{val.department}}">{{val.department}}</option>
        {% endfor %}
        <option value="All">All</option>
      </select>
    </span>

    <span style="margin-left: 30;" class="btn">
      BUH
      <select name="Buhlist" id="buhead" class="btn" style="border-radius: 30px;">
        <option value="{{buh_select}}" selected disabled hidden>{{buh_select}}</option>
        {% for val in BUHList %}
        <option value="{{val.eFname}}">{{val.eFname}}</option>
        {% endfor %}
        <option value="All">All</option>
      </select>
    </span>

    <span style="margin-left: 30;" class="btn">
      Manager
      <select name="managerlist" id="manager" class="btn" style="border-radius: 30px;">
        <option value="{{manager_select}}" selected disabled hidden>{{manager_select}}</option>
        {% for val in Manager %}
        <option value="{{val.eFname}}">{{val.eFname}}</option>
        {% endfor %}
        <option value="All">All</option>
      </select>
    </span>
    <span style="margin-left: 30;">
      <button class="go-btn" style="border-radius: 30px;" type="submit"
        onClick="window.location.href = getLink()">Search</button>

    </span>
    <span style="margin-left: 10;">
      <button class="go-btn" style="border-radius: 30px;" type="submit"
        onclick="location.href='/listEmployees'">Refresh</button>
    </span>

  </div>
</div>
<script>
  function getLink() {
    var Bu = document.querySelector("#Bu").value;
    var buhead = document.querySelector("#buhead").value;
    var manager = document.querySelector("#manager").value;
    var url = '/filter/' + encodeURIComponent(Bu) + '/' + encodeURIComponent(buhead) + '/' + encodeURIComponent(manager);
    return url;
  }
</script>

</div>


<div class="container-fluid">
  <table class="table table-bordered table-hover" id="example" name="example">
    <thead class="bg-info text-white">
      <tr>
        <th>Employee ID.</th>
        <th>Name</th>
        <th>Customer</th>
        <th>DEPT</th>
        <th>BUH</th>
        <th>Manager</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Role</th>
        <th>Status</th>
        <th>LeadSoc Joining Date</th>
        <th>Customer Start Date</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      {% for employee in employees %}
      <tr>
        <td>{{employee.e_id}}</td>
        <td>{{employee.eFname}} {{employee.eLname}}</td>
        <td>{{employee.refer_Customer}}</td>
        <td>{{employee.department}}</td>
        <td>{{employee.BUH}}</td>
        <td>{{employee.Manager}}</td>
        <td>{{employee.eEmail}}</td>
        <td>{{employee.ePhone}}</td>
        <td>{{employee.eRole}}</td>
        <td>{{employee.estatus}}</td>
        <td>{{employee.leadsoc_joining_date}}</td>
        <td>{{employee.customer_start_date}}</td>

        <td>

          <button class="btn-danger btn-sm" onclick="location.href='/deleteLeadSocEmployee/{{employee.e_id}}'"><i
              class="fa-solid fa-trash"></i></button>
          {% if current_emp.eRole.role_name == 'HR' or current_emp.eRole.role_name == 'BUH' %}
          <button class="btn-success btn-sm" data-toggle="modal" data-target="#modalForm{{employee.ePhone}}"><i
              class="fa-solid fa-pen-to-square"></i>
          </button>
          {% else %}
          <span class="d-inline-block" tabindex="0" data-bs-toggle="popover{{employee.e_id}}"
            data-bs-trigger="hover focus" data-bs-content="Authorized for HR or Bu-Head only" data-bs-placement="left">
            <button class="btn-outline-secondary btn-success" disabled>
              <i class="fa-solid fa-pen-to-square"></i>
            </button>
          </span>

          <script>
            $(function () {
              $('[data-bs-toggle="popover{{employee.e_id}}"]').popover({ trigger: "hover focus" })
            })
          </script>
          {% endif %}
          <button class="btn-info btn-sm data" data-toggle="modal" data-target="#modalTable{{employee.ePhone}}">
            <i class="fa-solid fa-eye"></i>
          </button>


          <div class="modal" id="modalTable{{employee.ePhone}}" data-bs-backdrop="static" data-bs-keyboard="false"
            tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <h5>Experience</h5>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                  <h5>Employee Name: {{employee.eFname}} {{employee.eLname}} </h5>
                  <table class="table table-striped" id="example1" name="example1">
                    <thead>
                      <tr>
                        <th>Company</th>
                        <th>Customer Start Date</th>
                        <th>Customer End Date</th>
                        <th>Duration (In Days)</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for val in experiencelist %}
                      {% if val.e_id == employee.e_id %}
                      <tr>
                        <td>{{val.refer_customer}}</td>
                        <td>{{val.customer_start_date}}</td>
                        <td>{{val.customer_end_date}}</td>
                        <td>{{val.duration}}</td>
                        <td>
                          <button class="btn-success btn-sm">
                            <i class="fa-solid fa-pen-to-square"></i>
                          </button>
                          <button onclick="location.href='/deleteEmployeeExperience/{{val.id}}'"
                            class="btn-danger btn-sm">
                            <i class="fa-solid fa-trash"></i>
                          </button>
                        </td>
                      </tr>
                      {% endif %}
                      {% endfor %}
                      <tr id="new_row">
                        <form method="POST" action="/addEmployeeExperience/{{employee.e_id}}">
                          {% csrf_token %}
                          <td>
                            <select name="refer_customer" id="refer_customer">
                              {% for val in customerlist %}
                              <option value="{{val}}">{{val}}</option>
                              {% endfor %}
                            </select>
                          </td>
                          <td>
                            <input type='date' id='start_date' name="start_date">
                          </td>
                          <td>
                            <input type='date' id='end_date' name="end_date">
                          </td>
                          <td>
                            <button class='btn-info btn-sm' type='submit'>Add</button>
                          </td>
                        </form>
                      </tr>
                    </tbody>
                  </table>

                </div>

              </div>
            </div>
          </div>

          <div class="modal" id="modalForm{{employee.ePhone}}" data-bs-backdrop="static" data-bs-keyboard="false"
            tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5" id="staticBackdropLabel">Enter the new details</h1>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button>
                </div>

                <div class="modal-body">
                  <div class="container-fluid">
                    <form action="/updateLeadSocEmployee/{{employee.e_id}}" method="POST">
                      {% csrf_token %}
                      <div class="form-group">
                        <label for="Required_skills">Update First Name :</label>
                        <input type="text" class="form-control" id="eFname" name="eFname" placeholder="Enter First Name"
                          value="{{employee.eFname}}">
                      </div>
                      <div class="form-group">
                        <label for="eLname">Update Last Name:</label>
                        <input type="text" class="form-control" id="eLname" name="eLname" placeholder="Enter Last Name"
                          value="{{employee.eLname}}">
                      </div>
                      <div class="form-group">
                        <label for="refer_Customer">Customer</label>
                        <select name="refer_Customer" id="refer_Customer">
                          <option value="{{ employee.refer_Customer }}" selected >{{ employee.refer_Customer }}</option>
                          {% for val in customerlist %}
                          <option value="{{val}}">{{val}}</option>
                          {% endfor %}
                        </select>
                      </div>
                      <div class="form-group">
                        <label for="eEmail">Update Email Id :</label>
                        <input type="email" class="form-control" id="eEmail" name="eEmail" placeholder="Email"
                          value="{{employee.eEmail}}">
                      </div>
                      <div class="form-group">
                        <label for="ePhone">Phone :</label>
                        <input type="email" class="form-control" id="ePhone" name="ePhone" placeholder="Phone"
                          value="{{employee.ePhone}}">
                      </div>
                      <div class="form-group">
                        <label for="eRole">Update Role</label>
                        <select name="eRole" id="eRole">
                          <option value="{{ employee.eRole }}" selected >{{ employee.eRole }}</option>
                          {% for val in rolelist %}
                          <option value="{{val}}">{{val}}</option>
                          {% endfor %}
                        </select>

                      </div>
                      <div class="form-group">
                        <label for="Manager">Update Manager</label>
                        <select name="Manager" id="Manager">
                          <option value="{{ employee.Manager }}" selected >{{ employee.Manager }}</option>
                          {% for val in managers %}
                          <option value="{{val}}">{{val}}</option>
                          {% endfor %}
                        </select>
                      </div>


                      <div class="form-group">
                        <label for="department">Update department</label>
                        <select name="department" id="department">
                          <option value="{{ employee.department }}" selected >{{ employee.department }}</option>
                          {% for val in departments %}
                          <option value="{{val}}">{{val}}</option>
                          {% endfor %}
                        </select>
                      </div>
                      <div class="form-group">
                        <label for="estatus">Update status:</label>
                        <select name="estatus" id="estatus">
                           <option value="{{ employee.estatus }}" selected >{{ employee.estatus }}</option>
                          {% for val in statuslist %}
                          <option value="{{val}}">{{val}}</option>
                          {% endfor %}
                        </select>
                      </div>


                  </div>

                  <button type="submit" class="btn btn-primary">Update</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}