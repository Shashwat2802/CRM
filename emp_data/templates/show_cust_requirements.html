{% extends 'basic.html' %}
{% block extra %}
{% load custom_filters %}


{% endblock %}
{% block body %}
<center>
    <div>
        <h2 class="bg-info text-white">Customer Requirements</h2>
    </div>
</center>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
<div class="form-inline">
    <div class="d-inline-block">
        <span>
            <button class="go-btn" style="border-radius: 30px;"
                onclick="location.href='/salesSummary'">salesSummary</button>
        </span>
        <span class="btn">
            Sales
            <select class="btn" name="saleslist" id="sales">
                <option value="{{sales_select}}" selected hidden disabled>{{sales_select}}</option>
                {% for val in sales_incharge %}
                <option value="{{val.eFname}}">{{val.eFname}}</option>
                {% endfor %}
                <option value="All">All</option>
            </select>
        </span>
        <span style="margin-left: 30;" class="btn">
            BUH
            <select name="buhead" id="buhead" class="btn" style="border-radius: 30px;">
                <option value="{{bu_select}}" selected disabled hidden>{{bu_select}}</option>
                {% for val in bu_head %}
                <option value="{{val.eFname}}">{{val.eFname}}</option>
                {% endfor %}
                <option value="All">All</option>
            </select>
        </span>

        <span style="margin-left: 30;" class="btn">
            Status
            <select name="statuslist" id="status" class="btn" style="border-radius: 30px;">
                <option value="{{status_select}}" selected disabled hidden>{{status_select}}</option>
                <option value="Active">Active</option>
                <option value="Closed">Closed</option>
                <option value="All">Both</option>
            </select>
        </span>
        <span style="margin-left: 30;">
            <button class="go-btn" style="border-radius: 30px;" type="submit"
                onClick="window.location.href = getLink()">Search</button>

        </span>
        <span style="margin-left: 10;">
            <button class="go-btn" style="border-radius: 30px;" type="submit"
                onclick="location.href='/listSalesReqsFiltered/Choose/Choose/Choose'">Refresh</button>
        </span>

    </div>
</div>
<script>
    function getLink() {
        var buhead = document.querySelector("#buhead").value;
        var salesincharge = document.querySelector("#sales").value;
        var status = document.querySelector("#status").value;
        var url = '/listSalesReqsFiltered/' + encodeURIComponent(buhead) + '/' + encodeURIComponent(salesincharge) + '/' + encodeURIComponent(status);
        return url;
    }
</script>

</div>
<table class="table relative-top" id="salesReqTable">
    <thead class="badge-info text-white">
        <tr>
        <tr>
            <th>Sl#</th>
            <th>Customer</th>
            <th>Customer ReqID</th>
            <th>Skills</th>
            <th>Job Desc.</th>
            <th>Remarks</th>
            <th>Priority</th>
            <th>Exp.</th>
            <th>Total Reqs</th>
            <th>To Fill</th>
            <th>Status</th>
            <th>BDM</th>
            <th>BU Head</th>
            <th>Candidates</th>
            <th>Actions</th>
        </tr>
        </tr>
    </thead>

    <tbody>
        {% for val in customer_requirements %}
        <tr>
            <div>
                <td>{{forloop.counter}}</td>
                <td>{{val.customers}}</td>
                <td>{{val.Customer_Requirement_id}}</td>
                <td>{{val.Required_skills}}</td>
                <td>
                    <p class="btn-sm" data-toggle="modal" data-target="#jobDescriptionModal{{val.reqIdPK}}">
                        {{ val.Job_Description|default:'NA'|truncatewords:5 }}

                    </p>
                    <!-- JOb description Modal -->
                    <div class="modal fade" id="jobDescriptionModal{{val.reqIdPK}}" tabindex="-1" role="dialog"
                        aria-labelledby="jobDescriptionModalLabel{{val.reqIdPK}}" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-scrollable" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="jobDescriptionModalLabel{{val.reqIdPK}}">Job Description
                                    </h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p>{{val.Job_Description}}</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </td>
                <td>
                    <p class="btn-sm" data-toggle="modal" data-target="#hist{{val.reqIdPK}}">
                        {{ val.history|extract_from_hashtag }}
                    </p>
                    <!-- History Modal -->
                    <div class="modal fade" id="hist{{val.reqIdPK}}" tabindex="-1" role="dialog"
                        aria-labelledby="jobDescriptionModalLabel{{val.reqIdPK}}" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-scrollable" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="hist{{val.reqIdPK}}">Remarks
                                    </h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p>{{val.history|linebreaksbr }}</p>
                                </div>
                                <!-- <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div> -->

                                <div class="modal-body">
                                    <div class="container-fluid">
                                        <form action="/addSalesReqComment/{{val.reqIdPK}}" method="POST">
                                            {% csrf_token %}
                                            <div class="form-group">
                                                <label for="remark_text">Edit remarks:</label>
                                                <textarea name="remark_text" id="remark_text" cols="50"
                                                    rows="10"></textarea>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Add Comment</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </td>
                <td>{{val.priority}}</td>
                <td>{{val.Required_Experience}}</td>
                <td>{{val.Open_positions}}</td>
                <td>{{val.remain_positions}}</td>
                <td>{{val.Position_Status}}</td>
                <td>{{val.Sales_Incharge}}</td>
                <td>{{val.Bu_head}}</td>
                <!-- Button trigger modal -->
                <td>
                    <button type="button" class="btn-info btn-sm"
                        onclick="location.href='/mappedEmployeeToCustomer/{{val.reqIdPK}}'">
                        <i class="fa-regular fa-eye"></i>
                    </button>
                </td>
                <td>
                    <button class="btn-success btn-sm" data-toggle="modal" data-target="#modalForm{{val.reqIdPK}}"><i
                            class="fa-solid fa-pen-to-square"></i></button>
                    <!-- Modal form -->
                    <div class="modal" id="modalForm{{val.reqIdPK}}" data-bs-backdrop="static" data-bs-keyboard="false"
                        tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="staticBackdropLabel">Enter the new details</h1>
                                    <button type="button" class="close" data-dismiss="modal"
                                        aria-label="Close">&times;</button>
                                </div>

                                <div class="modal-body">
                                    <div class="container-fluid">
                                        <h6>Customer : {{val.customers}}</h6>
                                        <h6>Customer Requirement id : {{val.Customer_Requirement_id}}</h6>
                                        <form action="/updateSaleReqs/{{val.reqIdPK}}" method="POST">
                                            {% csrf_token %}

                                                <br>
                                                <label for="Position_Status">Position Status:</label>

                                                <select name="Position_Status" id="Position_Status">
                                                    <option value={{val.Position_Status}} selected>
                                                        {{val.Position_Status}}
                                                    </option>
                                                    <option value="Active">Active </option>
                                                    <option value="Closed">Closed </option>

                                                </select>

                                                <label for="priority">Priority</label>
                                                <select name="priority" id="priority">
                                                    <option value={{val.priority}} selected>{{val.priority}}</option>
                                                    <option value=1>P1</option>
                                                    <option value=2>P2</option>
                                                    <option value=3>P3</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="Required_skills">Updated Required Skills:</label>
                                                <input type="text" class="form-control" id="Required_skills"
                                                    name="Required_skills" value="{{val.Required_skills}}">
                                            </div>
                                            <div class="form-group">
                                                <label for="Job_Description">Updated Job Description:</label>
                                                <textarea name="Job_Description" id="Job_Description" cols="40"
                                                    rows="20">{{val.Job_Description}}</textarea>
                                            </div>

                                            <div class="form-group">
                                                <label for="Required_Experience">Updated Required
                                                    Experience:</label>
                                                <input type="number" class="form-control" id="Required_Experience"
                                                    name="Required_Experience" placeholder="enter required experience"
                                                    value="{{val.Required_Experience}}" min="0" max="100" step="0.1">
                                            </div>
                                            <div class="form-group">
                                                <label for="Open_positions">Updated Open positions:</label>
                                                <input type="number" class="form-control" id="Open_positions"
                                                    name="Open_positions" placeholder="Enter opened positions"
                                                    value="{{val.Open_positions}}">
                                            </div>



                                            <div class="form-group">
                                                <label for="Job_Description">Remarks</label>
                                                <textarea name="history" id="history" cols="40"
                                                    rows="20">{{val.history}}</textarea>
                                            </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="Sales_Incharge">Sales Incharge</label>
                                                <select name="Sales_Incharge" id="Sales_Incharge">
                                                {% for val in sales_incharge %}
                                                <option value="{{val}}">{{val}}</option>
                                                {% endfor %}
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="Bu_Head">Bu Head:</label>
                                                <select name="Bu_Head" id="Bu_Head">
                                                {% for val in bu_head %}
                                                <option value="{{val}}">{{val}}</option>
                                                {% endfor %}
                                                </select>
                                            </div>
                                        <div>
                                        <input type="submit" class="btn btn-info" value=" Update">
                                        <br>
                                    </form>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
        </tr>
        {% endfor %}
    </tbody>

</table>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- DataTables core library -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.min.css">
<script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>

<!-- DataTables Buttons extension library -->
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.0.1/css/buttons.dataTables.min.css">
<script src="https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.colVis.min.js"></script>
<script>
    $(document).ready(function () {
        $('#salesReqTable').DataTable({
            dom: 'Bfrtip',
            buttons: [
                'copyHtml5',
                'excelHtml5',
                'csvHtml5'
            ],
        });
    });
</script>
</div>
{% endblock %}
<!-- </nav> -->